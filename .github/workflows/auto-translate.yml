
name: 일본 드론 뉴스 자동 번역 및 게시

on:
  schedule:
    # 매일 오전 9시 (한국 시간 기준, UTC+9)
    # GitHub Actions는 UTC 기준이므로 00:00 UTC = 09:00 KST
    - cron: '0 0 * * *'
  
  # 수동 실행도 가능하게
  workflow_dispatch:

jobs:
  translate-and-post:
    runs-on: ubuntu-latest
    
    steps:
    - name: 코드 체크아웃
      uses: actions/checkout@v4
    
    - name: Python 설정
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: 의존성 설치
      run: |
        pip install -r requirements.txt
    
    - name: 이전 게시 기록 복원
      uses: actions/cache@v4
      with:
        path: posted_articles.json
        key: posted-articles-${{ github.run_id }}
        restore-keys: |
          posted-articles-
    
    - name: 뉴스 번역 및 게시 실행
      env:
        WP_USER: ${{ secrets.WP_USER }}
        WP_APP_PASSWORD: ${{ secrets.WP_APP_PASSWORD }}
      run: |
        python translate_and_post.py
    
    - name: 게시 기록 저장
      uses: actions/cache/save@v4
      if: always()
      with:
        path: posted_articles.json
        key: posted-articles-${{ github.run_id }}
    
    - name: 결과 알림
      if: always()
      run: |
        echo "✅ 작업 완료: $(date)"
